{% load partials %}
{% load player_extras %}
{% partialdef four-hands-3x3-partial %}
{# North at the top as per the Bridge Writing Style Guide #}
<div id="four-hands" style="border: 1px solid; height: 50%">
    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr 1fr">
        <div class="col"></div>
        <div class="col">
            {{ pokey_buttons.NORTH }}{{ card_display.NORTH.player.name_dir }}: {{ card_display.NORTH.cards }}
        </div>
        <div class="col"></div>
    </div>
    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr 1fr">
        <div class="col">{{ pokey_buttons.WEST }}{{ card_display.WEST.player.name_dir }}: {{ card_display.WEST.cards }}</div>
        <div class="col">{% include 'three-by-three-trick-display-partial.html#three-by-three-trick-display' %}</div>
        <div class="col">{{ pokey_buttons.EAST }}{{ card_display.EAST.player.name_dir }}: {{ card_display.EAST.cards }}</div>
    </div>
    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr 1fr">
        <div class="col"></div>
        <div class="col">
            {{ pokey_buttons.SOUTH }}{{ card_display.SOUTH.player.name_dir }}: {{ card_display.SOUTH.cards }}
        </div>
        <div class="col"></div>
    </div>
</div>
{% endpartialdef four-hands-3x3-partial %}
{% partialdef four-hands-3x3-scripts %}
<script>
var four_hands_event_source = new ReconnectingEventSource('{{ play_event_source_endpoint }}');

four_hands_event_source.addEventListener('message', function (e) {
    console.log("Play event listener saw " + e.data);

    var d = JSON.parse(e.data) ;
    if ("play" in d) {
      // TODO: Reload the partial only if the data indicates that the viewer, or dummy's, hands have changed.
      htmx.ajax('GET', '{{ four_hands_partial_endpoint }}', {target:'#four-hands', swap:'outerHTML'});
    }

}, false);

{# TODO: probably redundant, given that other stuff on this same page has the idential error handler #}
htmx.on("htmx:responseError", function(evt) {
   alert(evt.detail.xhr.response);
});

</script>
{% endpartialdef four-hands-3x3-scripts %}
